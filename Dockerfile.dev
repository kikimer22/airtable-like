FROM node:20-alpine
WORKDIR /app
ENV NODE_ENV=development
ENV NEXT_TELEMETRY_DISABLED=1
RUN npm install -g pnpm

# Build-time environment (passed via --build-arg / docker-compose args)
ARG DATABASE_URL
ARG DIRECT_DATABASE_URL
ENV DATABASE_URL=$DATABASE_URL
ENV DIRECT_DATABASE_URL=$DIRECT_DATABASE_URL

COPY package.json pnpm-lock.yaml* ./
RUN pnpm install
COPY . .
EXPOSE 3001
CMD ["sh", "-c", "npx prisma generate && pnpm dev"]
